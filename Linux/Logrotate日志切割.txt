一，nginx日志的配置实例参考:
/data/nginx*.log {
daily
dateext
missingok
rotate 15
compress
delaycompress
notifempty
create 755 root root
sharedscripts
postrotate
    if [ -f /usr/local/nginx/logs/nginx.pid ];then
	    kill -USR1 `cat /usr/local/nginx/logs/nginx.pid`
	fi
endscript
}

[root@VM_1_29_centos logrotate.d]# crontab -l
0 0 * * * /usr/sbin/logrotate -f /etc/logrotate.d/nginx


[root@VM_1_10_centos ~]# cat /etc/logrotate.d/abc
/data/xmt.log { 
rotate 5 
daily 
copytruncate 
compress 2
notifempty 
missingok 
dateext
} 

[root@VM_1_10_centos ~]# crontab -l
00 00 * * * /usr/sbin/logrotate -f /etc/logrotate.d/abc &>/dev/null
+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++


vim /etc/logrotate.d/nginx

/var/log/weblog/*.log {
    daily  //指定转储周期为每天
    compress  //通过gzip 压缩转储以后的日志
    rotate 7  //保存7天的日志
    missingok  //如果日志文件丢失，不要显示错误
    notifempty  //当日志文件为空时，不进行轮转
    dateext  //使用当期日期作为命名格式，exp: nginx_access.log-20190120
    sharedscripts  //运行postrotate脚本
    postrotate  //执行的指令
            if [ -f /run/nginx.pid ]; then
                    kill -USR1 `cat /run/nginx.pid`
            fi
    endscript  //结束指令
}




二，PHP-FPM日志的配置实例参考:
vim /etc/logrotate.d/nginx

/usr/local/php/var/log/*.log {
daily
compress
rotate 7
missingok
notifempty
dateext
sharedscripts
postrotate
    if [ -f /usr/local/php/var/run/php-fpm.pid ]; then
        kill -USR2 `cat /usr/local/php/var/run/php-fpm.pid`
    fi
endscript
}


三，tomcat日志的配置实例
问题描述：一般在部署Tomcat后，运行久了，catalina.out文件会越来越大，对系统的稳定造成了一定的影响。
1、定义tomcat的pid 文件
（1）修改catalina.sh 文件，定义Tomcat的pid文件的路径
[root@along ~]# vim /data/tomca/bin/catalina.sh
# Get standard environment variables
PRGDIR=`dirname "$PRG"`
CATALINA_PID=/var/run/tomcat.pid

（2）重启Tomcat，且查询pid
[root@along ~]# systemctl restart tomcat.service
[root@along ~]# cat /var/run/tomcat.pid
21924


2、配置切割设置
（1）配置切割
[root@along ~]# vim /etc/logrotate.d/tomcat_catalina
/data/tomcat/logs/catalina.out {
        daily
        rotate 15
        missingok
        notifempty
        dateext
        compress
        delaycompress
        sharedscripts
        create 644 root root
        postrotate
                if [ -f /var/run/tomcat.pid ]; then
                        kill -USR1 `cat /var/run/tomcat.pid`
                fi
        endscript
}

（2）USR1信号解释
　　USR1亦通常被用来告知应用程序重载配置文件；例如，向Apache HTTP服务器发送一个USR1信号将导致以下步骤的发生：停止接受新的连接，等待当前连接停止，重新载入配置文件，重新打开日志文件，重启服务器，从而实现相对平滑的不关机的更改。
　　在没有执行kill -USR1 `cat ${pid_path}`之前，即便已经对文件执行了mv命令而改变了文件名称，tomcat还是会向新命名的文件" xxx.out_ 20180619"照常写入日志数据的。原因在于：linux系统中，内核是根据文件描述符来找文件的。

3、测试执行
[root@along ~]# logrotate -vf /etc/logrotate.d/tomcat_catalina

4、设置logrotate定时任务
[root@along ~]# crontab -e
#auth root
#date 2018-06-19
00 00 * * * /usr/sbin/logrotate -vf /etc/logrotate.d/tomcat_catalina &>/dev/null
