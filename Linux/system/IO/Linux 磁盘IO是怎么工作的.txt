文件系统是对储存设备上的文件，进行组织管理的一种机制。而linux在各种文件系统实现上，又抽象了一层虚拟文件系统VFS，它定义了一组，所有文件系统都支持的，数据结构和标准接口；这样对于程序来说，只需要跟VFS提供的统一接口交互，而不需要关注文件系统的具体实现；对具体的文件系统来说，只需要按照VFS的标准，就可以无缝支持各种应用程序

VFS内部又通过目录项、索引节点、逻辑块以及超级块等数据结构来管理文件：
1.目录项，记录了文件的名字，以及文件与其他目录项之间的目录关系
2.索引节点，记录了文件的元数据
3.逻辑块，是由连续磁盘扇区构成的最小读写单元，用来存储文件数据
4.超级块，用来记录文件系统整体的状态，如索引节点和逻辑块的使用情况等

其中，目录项是一个内存缓存；而超级块、索引节点和逻辑块，都是存储在磁盘中的持久化数据


磁盘：
磁盘是可以持久化储存的设备，根据储存介质的不同，常见磁盘可以分为两类：机械磁盘(HDD,Hard Disk Driver)和固态磁盘(SSD,Solid State Disk)

1.HDD(机械磁盘)由盘片和读写磁头组成，数据就存储在盘片的环状磁道中。在读写数据前，需要移动读写磁头，定义到数据所在的磁道，然后才能访问数据；显然，如果I/O请求刚好连续，那就不需要磁道寻址，自然可以获得最佳性能。与之相对应的，当然就是随机I/O,它需要不停地移动磁头，来定位数据位置，所以读写速度就会比较慢
2.SSD(固态硬盘)，固态硬盘是固态电子元器件组成，固态磁盘不需要磁盘寻址，所以，不管是连续I/O,还是随机I/O,都比机械盘要好得多

磁盘的性能指标：
1.使用率，是指磁盘处理I/O的时间百分比，过高的使用率(比如超过80%)。通常意味着磁盘I/O存在瓶颈
2.饱和度，是指磁盘处理I/O的繁忙程度，过高的饱和度，意味着磁盘存在严重的性能瓶颈。当饱和度为100%时，磁盘无法接受新的I/O请求
3.IOPS（Input/Output per second）,是指每秒的I/O请求数
4.吞吐量，是指每秒的I/O请求大小
5.响应时间，是指I/O请求从发出到收到响应的间隔时间
备注：使用率只考虑有没有I/O,而不考虑I/O大小。换句话说，当使用率是100%的时候，磁盘依然有可能接受新的I/O请求；上述指标，都是经常挂在嘴边的，一讨论磁盘性能必定提起的对象。不过不要孤立地去比较某一指标，而要结合读写比例、I/O类型(随机还是连续)以及I/O的大小，综合分析

举个例子：
在数据库、大量小文件等这类随机读写比较多的场景中，IOPS更能反映系统的整体性能；而在多媒体等顺序读写较多的场景中，吞吐量才更能反映系统的整体性能
一般来说，我们在为应用程序的服务器选型时，要先对磁盘的I/O性能进行基准测试，以便可以准确评估，磁盘性能是否可以满足应用程序的需求

性能测试工具fio来测试磁盘的IOPS、吞吐量以及响应时间等核心指标。在基准测试时，一定要注意根据应用程序I/O的特点来具体评估指标；；当然，这就需要你测试出，不同的I/O大小（一般是512B至1MB中间的若干值）分别在随机读、顺序读、随机写、顺序写等各种场景下的性能情况

用性能工具得到的这些指标，可以作为后续分析应用程序性能的依据，一旦发生性能问题，可以把他们作为磁盘性能的极限值，进而评估磁盘I/O的使用情况



磁盘I/O观测：
iostat是最常用的磁盘I/O性能观测工具，它提供了每个磁盘的使用率、IOPS、吞吐量等各种常见的性能指标，当然，这些指标实际上来自/proc/diskstats
# -d -x 表示显示所有磁盘 I/O 的指标
$ iostat -d -x 1 
Device            r/s     w/s     rkB/s     wkB/s   rrqm/s   wrqm/s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util 
loop0            0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00 
loop1            0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00 
sda              0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00 
sdb              0.00    0.00      0.00      0.00     0.00     0.00   0.00   0.00    0.00    0.00   0.00     0.00     0.00   0.00   0.00 

上述指标需注意：
1.%util，就是我们前面提到的磁盘I/O使用率；由于可能存在并行I/O，100%并不一定表明磁盘I/O饱和
2.r/s+w/s 就是IOPS
3.rKB/s+wKB/s,就是吞吐量
4.r_await+w_await,就是响应时间



进程I/O观测：
上面提到的iostat只提供磁盘整体的I/O性能数据，缺点在于，并不能知道具体是哪些进程在进行磁盘读写。要观察进行的I/O情况，还可以使用pidstat和iotop这两个工具
$ pidstat -d 1 
13:39:51      UID       PID   kB_rd/s   kB_wr/s kB_ccwr/s iodelay  Command 
13:39:52      102       916      0.00      4.00      0.00       0  rsyslogd

1.用户 ID（UID）和进程 ID（PID） 。
2.每秒读取的数据大小（kB_rd/s） ，单位是 KB。
3.每秒发出的写请求数据大小（kB_wr/s） ，单位是 KB。
4.每秒取消的写请求数据大小（kB_ccwr/s） ，单位是 KB
5.块 I/O 延迟（iodelay），包括等待同步块 I/O和换入块I/O结束的时间，单位是时钟周期




